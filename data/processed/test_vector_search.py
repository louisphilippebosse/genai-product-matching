from google.cloud import aiplatform_v1

# Set variables for the current deployed index.
API_ENDPOINT="68284885.northamerica-northeast1-123728674703.vdb.vertexai.goog"
INDEX_ENDPOINT="projects/123728674703/locations/northamerica-northeast1/indexEndpoints/310642821172297728"
DEPLOYED_INDEX_ID="product_matching_deployment"

# Configure Vector Search client
client_options = {
  "api_endpoint": API_ENDPOINT
}
vector_search_client = aiplatform_v1.MatchServiceClient(
  client_options=client_options,
)

# Build FindNeighborsRequest object
datapoint = aiplatform_v1.IndexDatapoint(
    feature_vector=[-0.024638019502162933, -0.007331477012485266, -0.043079592287540436, -0.060814209282398224, 0.08296376466751099, 0.055271029472351074, 0.011007186956703663, -0.011481295339763165, 0.02575497142970562, 0.016120992600917816, 0.004860167391598225, 0.023885920643806458, 0.041756629943847656, -0.030733304098248482, -0.00797449704259634, -0.003921008203178644, 0.12592890858650208, -0.027862565591931343, -0.002399841556325555, -0.014175773598253727, 0.046434152871370316, -0.08977539092302322, -0.028176864609122276, 0.03046332858502865, -0.023057973012328148, -0.05189220979809761, 0.0008125279564410448, -0.01275558676570654, -0.03455368056893349, -0.010979214683175087, -0.01938128098845482, -0.027767032384872437, 0.06310217827558517, -0.004778208676725626, -0.03281155601143837, 0.045441482216119766, 0.026584070175886154, 0.006040825974196196, -0.0318903811275959, -0.002239332301542163, 0.028008634224534035, -0.020395174622535706, -0.000240673020016402, -0.02595522813498974, 0.01360126119107008, -0.03200181946158409, -0.03329479694366455, 0.016540756449103355, 0.02172267995774746, -0.027382023632526398, 0.012085591442883015, 0.01932338811457157, -0.015307067893445492, -0.004798761568963528, 0.03994870185852051, -0.01877972111105919, -0.05212485417723656, 0.04782463610172272, 0.019470950588583946, 0.005168678238987923, 0.004205550532788038, -0.043864473700523376, -0.008601166307926178, 0.06296738982200623, 0.0016068944241851568, 0.05559273064136505, 0.04443981498479843, 0.04548792913556099, 0.004410474095493555, -0.03825807571411133, -0.026983659714460373, 0.032601241022348404, -0.05872015655040741, 0.040315497666597366, 0.004532183986157179, 0.0384301021695137, -0.00020302539633121341, 0.0940178707242012, 0.0602128691971302, 0.005513265263289213, -0.0579674206674099, -0.024598784744739532, 0.016684114933013916, -0.010303574614226818, -0.030393334105610847, -0.09845275431871414, 0.04163019731640816, -0.03782151639461517, 0.016110539436340332, -0.008634339086711407, -0.029706744477152824, 0.0037387439515441656, -0.07362665981054306, 0.031182726845145226, 0.012456491589546204, 0.01855248026549816, -0.0007961131632328033, 0.02909775823354721, 0.002197715686634183, -0.007274153642356396, -0.01013045385479927, 0.04665224254131317, -0.002691135508939624, 0.004316145088523626, -0.04555279761552811, 0.020294155925512314, -0.004482402466237545, 0.05008956417441368, 0.04484371095895767, -0.024373481050133705, -0.09556408226490021, -0.027195382863283157, 0.04445359855890274, 0.008017628453671932, 0.03837995231151581, 0.014945045113563538, -0.07007236033678055, 0.010660716332495213, -0.047748588025569916, -0.04757090285420418, 0.009183716028928757, 0.0687592551112175, 0.03010665439069271, -0.0037146529648452997, -0.04975632578134537, -0.01266798097640276, 0.010577477514743805, 0.06502308696508408, -0.01496949139982462, -0.03141402080655098, 0.01798253133893013, -0.040473636239767075, 0.019389433786273003, -0.07549481093883514, -0.03534288331866264, -0.004651169292628765, -0.006361366715282202, 0.0052627152763307095, 0.04128003865480423, -0.0005509353941306472, 0.0278798695653677, -0.032779112458229065, 0.05393723025918007, -0.008074644021689892, 0.012086506001651287, -0.01769222877919674, -0.005889261141419411, -0.009144805371761322, 0.0037174364551901817, 0.02103537693619728, -0.0540609247982502, 0.0036015938967466354, -0.020111069083213806, -0.043785784393548965, -0.06326434761285782, -0.024376774206757545, 0.011137844063341618, 0.04671745002269745, -0.00952931772917509, -0.011038332246243954, 0.00050826754886657, 0.013313459232449532, -0.039974477142095566, 0.09483883529901505, 0.010246453806757927, -0.03823969140648842, 0.09879874438047409, 0.012139384634792805, 0.060981374233961105, -0.01361086405813694, 0.0018309615552425385, -0.06527677923440933, -0.021974675357341766, 0.0022235282231122255, 0.041913244873285294, -0.02378150448203087, 0.018115250393748283, 0.018668770790100098, -0.00278564658947289, 0.006411803886294365, -0.0013191468315199018, 0.002709140069782734, -0.0018553511472418904, 0.014332510530948639, -0.07988585531711578, 0.0077432552352547646, -0.043992623686790466, 0.03176191449165344, -0.038430105894804, -0.04607560485601425, -0.09857327491044998, -0.03422323986887932, 0.018502486869692802, 0.022973060607910156, 0.026466645300388336, 0.043785545974969864, 0.013139634393155575, -0.05956234037876129, -0.04815834388136864, 0.02243720553815365, 0.012975072488188744, 0.014989054761826992, 0.08017571270465851, -0.026691965758800507, -0.029779285192489624, -0.017478039488196373, 0.01105645950883627, 0.023111965507268906, -0.02122492529451847, -0.054044030606746674, -0.004965230356901884, -0.017230097204446793, -0.022897915914654732, -0.0005127437179908156, -0.02901151031255722, 0.03142804652452469, -0.0026759381871670485, -0.03629529848694801, 0.04264030605554581, -0.01547731552273035, 0.04626862332224846, 0.050119057297706604, 0.0022347194608300924, 0.0255208108574152, -0.029429342597723007, 0.016398960724473, 0.04130416363477707, -0.03540058806538582, 0.025161685422062874, 0.015201031230390072, 0.013085132464766502, 0.056409548968076706, -0.02631797082722187, -0.03460390493273735, 0.006843299604952335, -0.023730680346488953, 0.030679844319820404, 0.003438579849898815, -0.0374143086373806, -0.04549409821629524, 0.03209255635738373, 0.013720136135816574, -0.07599437236785889, 0.08993597328662872, -0.03841342777013779, -0.045610882341861725, 0.0008594517130404711, 0.08307325839996338, 0.025004111230373383, -0.03458886966109276, -0.012426509521901608, 0.005217274650931358, -0.015195127576589584, -0.014849774539470673, 0.09808570891618729, 0.00048236592556349933, 0.010413537733256817, 0.017595406621694565, -0.029184067621827126, 0.019998839125037193, 0.01946558803319931, 0.06463513523340225, -0.015691004693508148, -0.007525196764618158, 0.007129039149731398, 0.013242882676422596, 0.023554405197501183, 0.023073948919773102, -0.020684726536273956, 0.03829270228743553, -0.018674327060580254, 0.0016746203182265162, -0.021103480830788612, 0.0013138233916833997, -0.0069349901750683784, 0.04366938769817352, -0.05127491056919098, -0.02400323376059532, 0.012370053678750992, 0.030032368376851082, 0.03518267348408699, -0.06299667805433273, 0.011642832309007645, 0.03158019110560417, 0.012512344866991043, 0.03762106969952583, -0.08950337767601013, 0.03155282884836197, -0.040550604462623596, 0.017680635675787926, -0.052586622536182404, 0.033442698419094086, 0.004823623690754175, -0.009251742623746395, 0.025091784074902534, -0.01319332979619503, 0.008411294780671597, -0.02436453104019165, 0.013011159375309944, 0.026618696749210358, -0.0131775988265872, 0.002404651138931513, -0.018136171624064445, -0.0355374701321125, 0.032245807349681854, -0.04581626132130623, -0.022191166877746582, -0.026358066126704216, 0.0376846045255661, 0.02587253600358963, -0.027988484129309654, 0.00907184835523367, 0.06320177018642426, 0.031269002705812454, -0.044374603778123856, -0.009893516078591347, 0.009908606298267841, -0.04501804709434509, 0.03594989329576492, -0.049356237053871155, 0.023079633712768555, -0.01274887565523386, 0.05610558018088341, 0.023374971002340317, 0.003984783310443163, -0.019496893510222435, 0.041560929268598557, 0.04031887277960777, 0.003423773217946291, -0.043494392186403275, -0.05538921430706978, 0.020260484889149666, 0.04925050958991051, -0.00666853878647089, 0.02601354941725731, 0.019604643806815147, -0.018200626596808434, 0.0018547005020081997, 0.015423246659338474, 0.035513803362846375, 0.016827546060085297, 0.038288429379463196, -0.08201383799314499, 0.01871381513774395, -0.020076295360922813, -0.04128079488873482, -0.032514408230781555, 0.003969128709286451, -0.01976803131401539, 0.01170909684151411, 0.01983393169939518, 0.004725380800664425, 0.028563037514686584, -0.0497841015458107, -0.006208676379173994, -0.04209350422024727, -0.023317662999033928, 0.022481141611933708, 0.003094961168244481, -0.0039429678581655025, 0.006893257610499859, 0.012266118079423904, -0.017118418589234352, -0.031086256727576256, -0.028435800224542618, -0.0023732506670057774, 0.019348349422216415, -0.020591430366039276, 0.01834714785218239, -0.016888998448848724, -0.05949442833662033, 0.016998806968331337, -0.010611006990075111, -0.01761755533516407, 0.02443818561732769, -0.05563224107027054, -0.008130863308906555, -0.02743726782500744, -0.006719687953591347, 0.047273460775613785, -0.01810038462281227, -0.02274039201438427, -0.06359350681304932, 0.004719777498394251, -0.020287027582526207, 0.009671526029706001, -0.03089849092066288, 0.0011290430556982756, -0.058813996613025665, 0.020573940128087997, 0.0027855373919010162, 0.024942858144640923, -0.029698418453335762, -0.05276420712471008, -0.02433302067220211, -0.0071602133102715015, -0.009941843338310719, -0.031049953773617744, -0.02425970882177353, -0.0694059431552887, 0.033292729407548904, 0.03080863133072853, 0.04847703129053116, 0.0046607088297605515, -0.019715094938874245, -0.04301377385854721, -0.01758406311273575, -0.019761918112635612, -0.04623844474554062, -0.05411657691001892, -0.033964551985263824, -0.008533419109880924, 0.06930190324783325, 0.052264660596847534, -0.01773085817694664, -0.020715584978461266, 0.013984096236526966, -0.0023810111451894045, 0.06828898936510086, -0.002192123793065548, -0.0041132038459181786, 0.041492387652397156, 0.007628252729773521, 9.086032514460385e-05, -0.0630469024181366, -0.04559736326336861, 0.027936382219195366, -0.021989304572343826, 0.023466026410460472, 0.010661061853170395, -0.043302688747644424, 0.016437750309705734, 0.015506912022829056, -0.0011552837677299976, 0.018312113359570503, -0.026322871446609497, -0.014961731620132923, -0.01022519450634718, 0.057293687015771866, 0.02198341302573681, -0.08616264909505844, 0.019846230745315552, 0.01806868426501751, 0.02674470655620098, 0.011768776923418045, -0.032555270940065384, -0.00805134791880846, -0.024655470624566078, -0.0028771194629371166, 0.02275904454290867, -0.037374503910541534, 0.003348245983943343, -0.04963831603527069, 0.030314551666378975, -0.03154721483588219, 0.0496276430785656, 0.012979129329323769, 0.0345037505030632, 0.034825459122657776, -0.01454851683229208, -0.006897462531924248, 0.016408834606409073, -0.05542633309960365, 0.03652118891477585, 0.0616733692586422, -0.07681272178888321, -0.04538526386022568, -0.06651683151721954, -0.050361037254333496, -0.05030082166194916, 0.02737453021109104, -0.031246814876794815, 0.03728903830051422, 0.019695423543453217, -0.0063453433103859425, 0.0025736261159181595, 0.01384776085615158, 0.02137923240661621, -0.006189490668475628, 0.03304607793688774, -0.007582041434943676, 0.03886426240205765, 0.002068674424663186, 0.053123682737350464, 0.014118918217718601, 0.02015584148466587, -0.0340462401509285, -0.06776954978704453, -0.016633091494441032, -0.020443592220544815, 0.031941432505846024, 0.02852862887084484, -0.02913900464773178, -0.08095505833625793, -0.020826401188969612, -0.00991870742291212, -0.029061412438750267, 0.057788070291280746, -0.05003172904253006, -0.06187508627772331, -0.010610518045723438, 0.0051278648898005486, -0.07370854914188385, -0.013023922219872475, -0.05696422606706619, -0.03948522359132767, 0.03191910684108734, 0.04609549790620804, -7.414388528559357e-05, -0.0432724691927433, -0.04234181344509125, 0.010156041942536831, -0.028443293645977974, -0.02208239957690239, 0.03602830320596695, 0.021953819319605827, 0.0364772230386734, -0.04532896354794502, -0.015109334141016006, 0.07906905561685562, -0.06786937266588211, 0.014190707355737686, -0.012519718147814274, -0.03234883025288582, -0.014807257801294327, -0.00933875422924757, 0.04446155205368996, 0.01860496774315834, -0.02057517319917679, 0.07604558020830154, -0.0020406129769980907, -0.011124150827527046, -0.0508933886885643, 0.0027902713045477867, 0.017669031396508217, -0.0035820126067847013, -0.046199243515729904, 0.006036847364157438, 0.004827076569199562, 0.051407184451818466, -0.03297077491879463, -0.0440533384680748, -0.007328345440328121, 0.011695655062794685, 0.017559105530381203, 0.002159672323614359, -0.01869121938943863, -0.0015329818706959486, -0.047497984021902084, 0.0071297287940979, 0.009227613918483257, -0.02200409211218357, 0.011179356835782528, -0.010685086250305176, -0.026484444737434387, 0.013752413913607597, 0.006556869484484196, -0.028750505298376083, 0.03768909350037575, -0.014915980398654938, 0.0015367293963208795, 0.021687466651201248, 0.02510029263794422, -0.03314199298620224, -0.017486730590462685, 0.007006310857832432, -0.06763139367103577, 0.022446289658546448, -0.0659855306148529, 0.021358761936426163, 0.029146917164325714, -0.011185220442712307, -0.04859097674489021, 0.02131711132824421, 0.03707151487469673, -0.014874858781695366, -0.006209272425621748, 0.031133824959397316, 0.009196837432682514, 0.015848057344555855, -0.003658656030893326, -0.01743405871093273, 0.032552462071180344, 0.003701371606439352, 0.048124607652425766, 0.011025093495845795, 0.01764027401804924, -0.05756742134690285, 0.022415637969970703, -0.013591035269200802, 0.05788196995854378, -0.007627585437148809, -0.0031306741293519735, 0.06278925389051437, -0.00826188363134861, 0.0264891367405653, 0.002191562205553055, -0.011389161460101604, 0.08267579972743988, -0.01940206065773964, -0.01751083880662918, -0.04782143980264664, 0.005822965409606695, -0.0022008344531059265, 0.010356005281209946, -0.03022211790084839, -0.08111079037189484, -0.026769857853651047, 0.08791090548038483, -0.06762775778770447, 0.059089187532663345, -0.006380290258675814, -0.026013758033514023, 0.008835946209728718, -0.018499836325645447, 0.047821175307035446, 0.017734548076987267, -0.010453777387738228, -0.027394840493798256, -0.017798583954572678, -0.0003765008586924523, -0.0008721444755792618, 0.04558798298239708, -0.04731610417366028, 0.017963776364922523, -0.00157498090993613, 0.004991208203136921, 0.020164020359516144, -0.03043605200946331, -0.0010965293040499091, -0.028001761063933372, -0.03033444844186306, 0.011196150444447994, -0.00696256197988987, -0.05031496658921242, 0.03050212375819683, 0.00536523200571537, -0.0064551858231425285, -0.0018783031264320016, 0.011364537291228771, -0.018755432218313217, -0.04549011215567589, -0.04424329474568367, 0.000432418892160058, -0.025375688448548317, -0.0019797326531261206, 0.01800171658396721, -0.03633330389857292, 0.04098924621939659, -0.015058225952088833, -0.007775980979204178, -0.07282666862010956, -0.06615522503852844, 0.003802249673753977, 0.024841507896780968, -0.11743864417076111, 0.09662742167711258, 0.018577098846435547, -0.0646364614367485, 0.03987335041165352, -0.02715197391808033, -0.011748780496418476, -0.03868160769343376, 0.06278473883867264, 0.053526755422353745, -0.05838721990585327, -0.023234233260154724, 0.00637646671384573, -0.030740877613425255, -0.06858086585998535, -0.03030882216989994, -0.01273986417800188, -0.03292950242757797, 0.05997837707400322, -0.04648391902446747, -0.03178875893354416, 0.01932630129158497, -0.025944726541638374, 0.023775199428200722, -8.220597010222264e-06, 0.005697518587112427, 0.013128862716257572, 0.002870876807719469, 0.00677478825673461, -0.03032844513654709, -0.01730319857597351, 0.03826071321964264, -0.053816765546798706, -0.02664322592318058, 0.03954613581299782, -0.010409846901893616, 0.048995036631822586, 0.023010333999991417, -0.0887942761182785, 0.001532839029096067, 0.015196362510323524, 0.004770459141582251, -0.013917481526732445, 0.029023807495832443, -0.0420529805123806, -0.05690426379442215, 0.03088209591805935, 0.03343096002936363, -0.007647477090358734, 0.04808291047811508, -0.04557732120156288, 0.010076643899083138, 0.004255893640220165, -0.008604838512837887, 0.03337240219116211, -0.006695495452731848, 0.001499437727034092, -0.03169328346848488, -0.036222975701093674, -0.007954912260174751, 0.014378401450812817, -0.050256624817848206, -0.023833153769373894, -0.019638366997241974, -0.022519363090395927, 0.13354267179965973, -0.04730365425348282, 0.017530381679534912, -0.009090065956115723, 0.04753118380904198, -0.007378301117569208, -0.06317159533500671, -0.02389463223516941, 0.0086127370595932, 0.07679153233766556, -0.006705433130264282, -0.07486453652381897, -0.022357309237122536, 0.015785951167345047, 0.008203334175050259, -0.021345708519220352, -0.0849648043513298, 0.028543736785650253, -0.02404864877462387, -0.017293374985456467, 0.04192296788096428, -0.007176111917942762, 0.011643174104392529, -0.05484744906425476, -0.0648340955376625, -0.0023774453438818455, -0.03288503736257553, 0.0599370114505291, -0.057943228632211685, 0.017752792686223984, -0.12869608402252197, -0.0085150096565485, -0.014287571422755718, -0.02816512994468212, 0.009112752042710781, 0.07588299363851547, -0.027447473257780075, 0.011969433166086674, 0.014695701189339161, 0.0017015245975926518, 0.006937454920262098, 0.02052396908402443, 0.027919942513108253, 0.014541163109242916, -0.026244953274726868, -0.042088158428668976, 0.08470649272203445, -0.031815581023693085]
)

query = aiplatform_v1.FindNeighborsRequest.Query(
  datapoint=datapoint,

  # The number of nearest neighbors to be retrieved
  neighbor_count=20
)
request = aiplatform_v1.FindNeighborsRequest(
  index_endpoint=INDEX_ENDPOINT,
  deployed_index_id=DEPLOYED_INDEX_ID,
  # Request can have multiple queries
  queries=[query],
  return_full_datapoint=False,
)

# Execute the request
response = vector_search_client.find_neighbors(request)

# Handle the response
print(response)